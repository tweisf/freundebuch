<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Freundebuch</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#0f172a;
  color:#f8fafc;
}
main{
  max-width:820px;
  margin:auto;
  padding:20px;
}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
h1,h2{margin:0 0 10px}
label{font-size:13px;color:#94a3b8}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  margin-bottom:12px;
  border-radius:12px;
  border:1px solid #334155;
  background:#020617;
  color:#f8fafc;
}
textarea{min-height:80px}
button{
  background:linear-gradient(135deg,#6366f1,#22d3ee);
  border:none;
  font-weight:700;
  cursor:pointer;
}
button:disabled{opacity:.6}
.entry{
  border:1px solid #1e293b;
  border-radius:16px;
  padding:14px;
  margin-top:14px;
  background:#020617;
}
.entry h3{margin:0}
.q{color:#94a3b8;font-size:13px;margin-top:10px}
.a{margin-top:4px}
img{
  width:100%;
  border-radius:14px;
  margin-top:10px;
}
hr{
  border:none;
  border-top:1px solid #1e293b;
  margin:14px 0;
}
.status{margin-top:10px}
</style>
</head>

<body>
<main>

<h1>ðŸ“˜ Freundebuch</h1>

<div class="card">
  <label>Dein Name *</label>
  <input id="name">

  <label>Woher kennen wir uns? *</label>
  <select id="kennen">
    <option value="">Bitte wÃ¤hlen</option>
    <option>Arbeit</option>
    <option>Freunde</option>
    <option>Feier / Event</option>
    <option>Online</option>
    <option>Sonstiges</option>
  </select>

  <label>Wie lange kennen wir uns? *</label>
  <select id="dauer">
    <option value="">Bitte wÃ¤hlen</option>
    <option>Heute</option>
    <option>Monate</option>
    <option>1â€“2 Jahre</option>
    <option>3â€“5 Jahre</option>
    <option>5+ Jahre</option>
  </select>

  <label>3 Worte, die mich beschreiben *</label>
  <input id="worte">

  <label>Worauf freust du dich gerade?</label>
  <input id="freu">

  <hr>

  <label>Auswahlspiel (alle Pflicht)</label>
  <select id="a1"><option value="">DÃ¶ner oder Pizza</option><option>DÃ¶ner</option><option>Pizza</option></select>
  <select id="a2"><option value="">Bier oder Wein</option><option>Bier</option><option>Wein</option></select>
  <select id="a3"><option value="">Netflix oder YouTube</option><option>Netflix</option><option>YouTube</option></select>
  <select id="a4"><option value="">Nacht oder FrÃ¼h</option><option>Nachtmensch</option><option>FrÃ¼haufsteher</option></select>
  <select id="a5"><option value="">Spontan oder geplant</option><option>Spontan</option><option>Geplant</option></select>

  <label>Emoji *</label>
  <select id="emoji">
    <option value="">ðŸ™‚</option>
    <option>ðŸ˜„</option><option>ðŸ˜Ž</option><option>ðŸ¥³</option><option>ðŸ«¶</option><option>ðŸ”¥</option>
  </select>

  <label>Foto (optional)</label>
  <input type="file" id="image" accept="image/*">

  <button onclick="save()">Eintrag speichern</button>
  <div class="status" id="status"></div>
</div>

<h2>ðŸ“Œ EintrÃ¤ge</h2>
<div id="entries"></div>

</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCLnz3t9VcQJLg2oqbZd2cA7-hXF30UyHM",
  authDomain: "freundebuch-neu.firebaseapp.com",
  projectId: "freundebuch-neu",
  storageBucket: "freundebuch-neu.firebasestorage.app",
  messagingSenderId: "732597691942",
  appId: "1:732597691942:web:2c116f530c4179d1c2a8e7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

function esc(s){return String(s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]))}

async function uploadImage(file){
  const ref = storage.ref("uploads/"+Date.now()+"_"+file.name);
  await ref.put(file);
  return await ref.getDownloadURL();
}

async function save(){
  const required = [
    name.value, kennen.value, dauer.value, worte.value,
    a1.value,a2.value,a3.value,a4.value,a5.value,emoji.value
  ];
  if(required.some(v=>!v)){
    status.textContent="âŒ Bitte alles ausfÃ¼llen";
    return;
  }

  status.textContent="â³ Speichern...";
  let imageUrl="";
  if(image.files[0]) imageUrl = await uploadImage(image.files[0]);

  await db.collection("entries").add({
    type:"freundebuch",
    created:new Date(),
    imageUrl,
    answers:{
      name:name.value,
      kennen:kennen.value,
      dauer:dauer.value,
      worte:worte.value,
      freu:freu.value,
      emoji:emoji.value,
      spiel:[a1.value,a2.value,a3.value,a4.value,a5.value]
    }
  });

  status.textContent="âœ… Gespeichert!";
  load();
}

async function load(){
  entries.innerHTML="â³ Lade...";
  const snap = await db.collection("entries").orderBy("created","desc").get();
  const docs = snap.docs.map(d=>d.data()).filter(d=>d.type==="freundebuch");

  entries.innerHTML = docs.map(d=>`
    <div class="entry">
      <h3>${esc(d.answers.name)}</h3>
      <div class="q">Woher kennen wir uns?</div><div class="a">${esc(d.answers.kennen)}</div>
      <div class="q">Wie lange?</div><div class="a">${esc(d.answers.dauer)}</div>
      <div class="q">3 Worte</div><div class="a">${esc(d.answers.worte)}</div>
      ${d.answers.freu?`<div class="q">Freust dich auf</div><div class="a">${esc(d.answers.freu)}</div>`:""}
      <div class="q">Auswahlspiel</div><div class="a">${esc(d.answers.spiel.join(" â€¢ "))}</div>
      <div class="q">Emoji</div><div class="a">${esc(d.answers.emoji)}</div>
      ${d.imageUrl?`<img src="${esc(d.imageUrl)}">`:""}
    </div>
  `).join("");
}

load();
</script>
</body>
</html>